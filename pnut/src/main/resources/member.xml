<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- namespace : xml을 구별하기 위한 이름  -->
<mapper namespace="memberns">
	<resultMap type="member" id="memberResult">
		<result property="m_id" column="m_id"/>
		<result property="m_pw" column="m_pw"/>
		<result property="m_name" column="m_name"/>
		<result property="m_nickname" column="m_nickname"/>
		<result property="m_email" column="m_email"/>
		<result property="m_tel" column="m_tel"/>
		<result property="m_intro" column="m_intro"/>
		<result property="m_regdate" column="m_regdate"/>
		<result property="m_del" column="m_del"/>
		<result property="m_profile" column="m_profile"/>
		<result property="m_bg" column="m_bg"/>
	</resultMap>
	<select id="select" parameterType="string" resultMap="memberResult">
		select * from pn_member where m_id=#{m_id}
	</select>
	<insert id="insert" parameterType="member">
		insert into pn_member values (#{m_id}, #{m_pw}, #{m_name}, #{m_nickname},
			#{m_email},#{m_tel},null,sysdate,'n','P-Nut.png','gray.png')
	</insert>
	<update id="update" parameterType="member">
		update pn_member set m_nickname=#{m_nickname}
		<if test="m_profile!=null">, m_profile=#{m_profile}</if>
		<if test="m_bg!=null">, m_bg=#{m_bg}</if>
		<if test="m_intro!=null">, m_intro=#{m_intro}</if>
		where m_id=#{m_id} 
	</update>
	<select id="search" parameterType="hashmap" resultMap="memberResult">
		select * from (select a.*, rownum rn from 
		(select * from pn_member where m_del='n'
		<foreach collection="arrayKw" item="item">
			and	(m_id like '%'||#{item}||'%' or m_nickname like '%'||#{item}||'%' or m_intro like '%'||#{item}||'%') 
		</foreach>) a)
		where rn between 1 and #{amt}
	</select>
	<select id="followingList" parameterType="hashmap" resultType="member">
		select * from	
			(select a.*, rownum rn from 	
				(select * from pn_member where m_del = 'n' and m_id in 
					<foreach collection="followlist" item="item" open="(" separator="," close=")">
						#{item}
					</foreach>) a)
				where rn between 1 and #{amt}
	</select>
</mapper>